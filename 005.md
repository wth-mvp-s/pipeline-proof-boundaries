

# E005 — Règles de sécurité appliquées par des contrôles bloquants 

Un pipeline ne doit jamais supposer qu’une étape est correcte parce qu’elle a été exécutée.  
Chaque étape critique doit être **explicitement validée** avant d’autoriser la suite.

Qu’il s’agisse d’un artefact, d’une infrastructure ou d’un runtime,  
si l’état réel n’est pas vérifié par un contrôle bloquant,  
le pipeline valide une hypothèse et non un état réel du système.

---

## Risque opérationnel

- le pipeline progresse alors que le runtime n’est pas encore prêt  
  *(ex. service en cours de démarrage, ressource cloud non opérationnelle)*

- des étapes suivantes sont exécutées alors qu’une erreur est déjà présente,  
  ce qui masque la cause réelle et complique le diagnostic

- le temps est perdu à analyser des symptômes tardifs,  
  alors que le pipeline aurait pu bloquer immédiatement

- les incidents apparaissent après coup,  
  car aucune barrière n’empêche la propagation d’un état invalide entre les étapes

## Exemple — absence de contrôle bloquant

Le pipeline ci-dessous effectue un déploiement sans étape préalable de validation, de test ou de blocage.
Dans ce cas, le pipeline suppose que l’artefact est correct.
Aucune règle n’est vérifiée, aucune violation ne peut bloquer le déploiement.

```yaml

- task: ArchiveFiles@2
  inputs:
    rootFolderOrFile: $(Build.ArtifactStagingDirectory)/runtime/output
    includeRootFolder: false
    archiveType: zip
    archiveFile: $(Build.ArtifactStagingDirectory)/runtime/output/SampleJob.zip

- task: AzureWebApp@1
  displayName: "Deploy application"
  inputs:
    appName: "demo-app"
    package: "$(Build.ArtifactStagingDirectory)/runtime/output/SampleJob.zip"
    deploymentMethod: "runFromPackage"
```


## Exemple — Garantie testée : le déploiement est bloqué sauf si l’état de l’artefact est explicitement vérifié.

Dans l’exemple suivant, le pipeline ne suppose pas que l’artefact existe ou est valide.
Il vérifie explicitement son existence et bloque l’exécution en cas d’échec.
```yaml

if [ ! -f "$FRONT_ARTEFACT_ROOT/index.html" ]; then
  echo "❌ Artefact not produced"
  exit 1
fi
```
```yaml
if [ -z "$(ls -A "$FRONT_ARTEFACT_ROOT")" ]; then
  echo "❌ Artefact directory is empty"
  exit 1
fi
```
